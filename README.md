# üß± Order Service

**Order Service** ‚Äî –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ **Go**. 
–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å **PostgreSQL**, **Kafka (Redpanda)**, **Redis-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**, **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (logrus)** –∏ **REST API** –Ω–∞ –±–∞–∑–µ **Chi**.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å —á–∏—Å—Ç—ã–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –¥–æ–º–µ–Ω–∞, –ø–æ—Ä—Ç–æ–≤ –∏ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ REST API
- **Kafka event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
    - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Å–µ—Ä–≤–∏—Å –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `order.upserted` –≤ Kafka
    - –û—Ç–¥–µ–ª—å–Ω—ã–π Kafka consumer ("cache projector") –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à
- **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    - LRU (in-memory) ‚Äî –¥–ª—è –ª—ë–≥–∫–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
    - Redis (—á–µ—Ä–µ–∑ `CACHE_BACKEND=redis`) ‚Äî –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω/–¥–æ–∫–µ—Ä–∞
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (`logrus`)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `docker-compose`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `.env` –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥-–ª–æ–∞–¥–µ—Ä

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
cmd/
 ‚îî‚îÄ‚îÄ server/           ‚Äî main entrypoint

internal/
 ‚îú‚îÄ‚îÄ adapters/         ‚Äî –≤–Ω–µ—à–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
 ‚îÇ   ‚îú‚îÄ‚îÄ http/handlers ‚Äî REST-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Chi)
 ‚îÇ   ‚îú‚îÄ‚îÄ kafka/        ‚Äî Kafka producer/consumer
 ‚îÇ   ‚îú‚îÄ‚îÄ repo/         ‚Äî PostgreSQL —Å–ª–æ–π (pgx)
 ‚îÇ   ‚îî‚îÄ‚îÄ cache/        ‚Äî LRU –∏ Redis-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
 ‚îÇ
 ‚îú‚îÄ‚îÄ app/orders/       ‚Äî –ø–æ—Ä—Ç—ã (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
 ‚îú‚îÄ‚îÄ domain/order/     ‚Äî —Å—É—â–Ω–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–∞
 ‚îú‚îÄ‚îÄ services/         ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
 ‚îú‚îÄ‚îÄ config/           ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (ENV loader)
 ‚îî‚îÄ‚îÄ logging/          ‚Äî –ª–æ–≥–≥–µ—Ä (logrus)
```

### üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å `POST /orders`
2. `OrderService` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–∫–∞–∑ –≤ PostgreSQL
3. –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka (`orders-events`)
4. Kafka Consumer (cache-projector) –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ ‚Üí —Ç—è–Ω–µ—Ç –∑–∞–∫–∞–∑ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç Redis/LRU –∫—ç—à

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è                                   |
|------------------|------------------------------------------------|
| **–Ø–∑—ã–∫**         | Go 1.22+                                       |
| **Web**          | Chi Router + net/http                          |
| **–ë–î**           | PostgreSQL + Goose migrations                  |
| **–ö—ç—à**          | Redis (go-redis/v9) / LRU                      |
| **–ë—Ä–æ–∫–µ—Ä —Å–æ–±—ã—Ç–∏–π** | Redpanda (Kafka-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è)                 |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**  | logrus (JSON-—Ñ–æ—Ä–º–∞—Ç)                           |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | —á–µ—Ä–µ–∑ `internal/config` + ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ       |
| **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** | Docker + docker-compose                      |

---

## üß† –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã


–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
- server ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π Go-—Å–µ—Ä–≤–∏—Å (`order-service`)
- postgres ‚Äî –ë–î
- redpanda ‚Äî Kafka –±—Ä–æ–∫–µ—Ä
- redis ‚Äî –∫—ç—à
- migrator/seeder ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- topic-init ‚Äî —Å–æ–∑–¥–∞—ë—Ç Kafka-—Ç–æ–ø–∏–∫ `orders-events`

---

## üîå –ü—Ä–∏–º–µ—Ä—ã API

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```json
{
  "track_number": "WBILMTEST-POST-001",
  "entry": "WBIL",
  "locale": "en",
  "customer_id": "cust-001",
  "delivery_service": "DHL",
  "shard_key": "9",
  "sm_id": 777,
  "oof_shard": 1,
  "delivery": {
    "name": "John Doe",
    "phone": "+1-555-0100",
    "zip": "94105",
    "city": "San Francisco",
    "address": "135 5th St",
    "region": "CA",
    "email": "john.doe@example.com"
  },
  "payment": {
    "transaction": "tx-POST-001",
    "request_id": "req-POST-001",
    "currency": "USD",
    "provider": "visa",
    "amount": 350,
    "payment_dt": "2021-11-26T07:22:19Z",
    "bank": "BigBank",
    "delivery_cost": 50,
    "goods_total": 300,
    "custom_fee": 0
  },
  "items": [
    {
      "chrt_id": "ch-1",
      "track_number": "WBILMTEST-POST-001",
      "price": 200,
      "rid": "rid-1",
      "item_name": "item-1",
      "sale": 0,
      "item_size": 10,
      "total_price": 200,
      "nm_id": "nm-1",
      "brand": "brand-A",
      "status": 1
    }
  ]
}
```

---

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```json
{
  "time": "2025-10-30T06:54:55+03:00",
  "level": "info",
  "msg": "Order successfully created or updated",
  "order_uid": "3cb63b3f-e181-47ab-92c2-3b3e54714920"
}
```

---
